---
description: Smoke-тестирование CLI, скриптов и целостности данных
alwaysApply: true
---

# Smoke-тестирование

## Подход
- Для этого проекта smoke-проверки выполняются в первую очередь через CLI и PowerShell-скрипты, а не только через HTTP/CURL.
- Валидировать результат по трём источникам:
  1. stdout/stderr команды,
  2. логи (`logs/app.log` и экспортные `*/logs/run.log`, `*/logs/errors.log`),
  3. данные в БД (через MCP, либо `psql` fallback).

## Цикл при провале тестов
1. Зафиксируй точную команду, exit code и ключевые строки ошибки.
2. Проверь логи и состояние БД.
3. Исправь причину.
4. Повтори тот же smoke-кейс.
5. Прерывайся только если нужны действия пользователя (секреты, доступы, внешний сервис, подтверждение выбора).

## Минимальный smoke-чеклист
- Команда запускается без синтаксических ошибок.
- Exit code соответствует контракту (`0/1/2/130`, где применимо).
- В summary/логах есть ожидаемые поля (`run_id`, `error_code`, счётчики).
- В БД появились/обновились ожидаемые записи (если сценарий включает БД).

## Тестовые данные
- Источник тестовых данных: реальная БД (read-only) или заранее подготовленные тестовые артефакты проекта.
- Добавление мок-данных в БД допустимо только если это явно требуется ТЗ и выполняется через миграции/скрипты проекта.
