# WordPress Source — риски, ограничения и открытые вопросы

**Дата:** 2026-02-23  
**Связанные документы:** все документы пакета wp-source-*

---

## 1. Риски

| Риск | Вероятность / влияние | Митигация |
|------|------------------------|-----------|
| **Различия версий WP и плагинов** | Средняя / среднее | Минимальная версия WP зафиксирована: 6.0+; маппинг SEO устойчив к отсутствию yoast_head_json. |
| **Rate limit на стороне хостинга** | Средняя / высокое | Лимит 3 req/s соблюдать строго; при 429 — retry с backoff; в конфиге допустить снижение частоты (например 1 req/s) для «капризных» хостов. |
| **Большие объёмы контента** | Низкая / среднее | Пагинация по 100; при необходимости ввести общий timeout run и статус partial; мониторить время выполнения в summary. |
| **Утечка кредов** | Низкая / высокое | Креды только в конфиге/env, не в логах и не в коде; документация по безопасному хранению (env-файлы с ограничением прав). |
| **Регрессия TG** | Средняя / высокое | Не менять telegram_parser.py и telegram_parser_skill.py по функционалу; общие изменения только в errors.py и logging; обязательный прогон smoke-тестов TG после любых правок. |
| **Отсутствие content.raw в API** | Низкая / низкое | В MVP используется только content.rendered; опция context=edit и content.raw вынесена в phase 2. |
| **Multisite и разные версии REST** | Низкая / среднее | Каждый сайт в multisite имеет свой base URL; тестировать на реальном multisite при поддержке нескольких сайтов. |

---

## 2. Ограничения (MVP и явные допущения)

- **Только чтение:** обратной записи в WordPress нет и не планируется в рамках этой фичи.
- **Full sync:** инкрементальная синхронизация (только изменённые с даты) не входит в MVP.
- **Статус:** только `publish`; черновики и прочие статусы не выгружаются.
- **Gutenberg:** сырые комментарии блоков не извлекаются в MVP; архитектура допускает расширение (поля в БД или отдельная таблица).
- **Один инстанс на сайт:** параллельный запись в один и тот же site_id из нескольких процессов не предусмотрен; оркестратор должен вызывать sync последовательно по сайтам или один run на все сайты по очереди.
- **Удаление записей:** при исчезновении поста/страницы на WP из ответа API записи в БД в MVP не удаляются автоматически (идемпотентность за счёт upsert; «очистка» — отдельная опция или команда).
- **SEO:** состав полей зависит от плагина (Yoast/Rank Math); при отсутствии плагина поля seo_* остаются NULL.
- **Язык документации и кода:** по правилам проекта — русский для коммитов и пользовательских сообщений; код и имена переменных/типов могут оставаться на английском.

---

## 3. Зафиксированные решения (до старта разработки)

Следующие решения зафиксированы и не требуют согласования в ходе реализации:

| № | Решение |
|---|---------|
| 1 | **Конфиг:** YAML-файл `config/wp-sites.yml` (список сайтов: site_id, base_url, name) + переменные окружения для секретов (Application Password, при необходимости логин). |
| 2 | **run_id:** один на весь запуск sync; в каждой записи БД и в каждом логе дополнительно указывается `site_id`. |
| 3 | **post_content:** в MVP использовать только `content.rendered`; опция `context=edit` и `content.raw` — phase 2. |
| 4 | **Минимальная версия WordPress:** 6.0+. |
| 5 | **Миграции:** отдельная папка в проекте `migrations/wp/`. |
| 6 | **Интеграция с ContentItem (contracts.py):** в MVP не включать; только экспорт в БД и единый JSON output. Маппинг в ContentItem — при появлении общего пайплайна (phase 2 и далее). |

---

## 4. Открытые вопросы (опционально, в ходе реализации)

- **Поле username в REST API users:** в части версий/контекстов возвращается только slug; при необходимости уточнить, достаточно ли slug для отображения «автор».
- **Custom post types:** нужны ли в MVP кроме post и page; если да — перечень и маппинг в content_type.
- **Способ применения миграций:** ручной скрипт, Alembic или иное — на усмотрение команды.
